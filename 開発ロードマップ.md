# 急成長スタートアップ向け組織管理SaaS 開発ロードマップ

## 📋 プロジェクト概要

### ターゲット・課題
- **ターゲット**: 急成長スタートアップ（50人〜）
- **主要課題**: 組織再編・部署移動が頻繁、採用計画と組織計画の連動が困難
- **利用者**: CEO、人事、経営企画
- **価格**: 月額5万円固定料金
- **組織変更頻度**: 月1回程度

### 差別化ポイント
1. **採用計画と組織図の完全連動**
2. **急成長企業特化の機能設計**
3. **シンプルで直感的なUI/UX**

## 🔍 現在の実装状況

### ✅ 実装済み機能
- 基本認証システム（NextAuth.js、4つの役割）
- 従業員管理（CRUD、階層関係）
- 組織図可視化（React Flow）
- バージョン管理システム（組織状態の保存・比較）
- シミュレーションエンジンの基盤
- 基本UI（ダッシュボード、設定画面）

### 📐 技術スタック
- **フロントエンド**: Next.js 15 + TypeScript + React 19
- **スタイリング**: Tailwind CSS + shadcn/ui
- **可視化**: React Flow（組織図可視化）
- **バックエンド**: Supabase（PostgreSQL + Auth + Realtime + Edge Functions）
- **決済**: Stripe（Subscriptions + Invoices + Webhooks）
- **認証**: Supabase Auth（NextAuth.jsから移行）

## 🚀 4フェーズ開発ロードマップ

### **フェーズ1: 採用計画MVP（2-3ヶ月）**
**目標**: 採用計画と組織図連動による差別化価値の提供

#### 主要機能
1. **採用計画管理システム**
   - 採用予定ポジションのCRUD操作
   - 基本情報管理（ポジション名、必要スキル、想定年収、採用予定時期、緊急度、採用理由、レポートライン）

2. **組織図への採用予定表示**
   - React Flow拡張で「予定ポジション」ノード表示
   - 既存従業員と採用予定の視覚的区別
   - ドラッグ&ドロップでの配置変更

3. **基本予算計算**
   - 採用に伴う人件費変化の自動計算
   - 部署別コスト影響の表示

4. **採用タイムライン表示**
   - 月次/四半期ビューでの採用スケジュール
   - 緊急度による優先度表示

#### 技術実装
```typescript
// 新規ドメインモデル
interface RecruitmentPlan {
  id: string;
  tenant_id: string; // Supabaseマルチテナント対応
  positionTitle: string;
  department: string;
  reportingManager: string;
  requiredSkills: string[];
  estimatedSalary: number;
  targetHireDate: Date;
  urgency: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';
  reason: 'EXPANSION' | 'REPLACEMENT' | 'NEW_INITIATIVE';
  status: 'PLANNED' | 'IN_PROGRESS' | 'HIRED' | 'CANCELLED';
}

// Supabase統合
const useRecruitmentPlans = (tenantId: string) => {
  return useQuery({
    queryKey: ['recruitment-plans', tenantId],
    queryFn: () => supabase
      .from('recruitment_plans')
      .select('*')
      .eq('tenant_id', tenantId)
  });
};
```

#### Supabase設定
```sql
-- 採用計画テーブル
CREATE TABLE recruitment_plans (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  tenant_id UUID REFERENCES tenants(id),
  position_title VARCHAR(255) NOT NULL,
  department VARCHAR(255),
  estimated_salary INTEGER,
  target_hire_date DATE,
  urgency VARCHAR(20) DEFAULT 'MEDIUM',
  status VARCHAR(50) DEFAULT 'PLANNED',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS設定
ALTER TABLE recruitment_plans ENABLE ROW LEVEL SECURITY;
CREATE POLICY "tenant_isolation" ON recruitment_plans 
  FOR ALL USING (tenant_id = get_user_tenant_id());
```

### **フェーズ2: 高度なシミュレーション・承認機能（2-3ヶ月）**
**目標**: 経営判断支援機能の強化

#### 主要機能
1. **承認ワークフローシステム**
   - 採用計画の段階的承認プロセス
   - CEO/人事/経営企画の権限別承認フロー
   - 承認理由・却下理由の記録

2. **高度なシミュレーション**
   - 採用計画を含む組織変更シミュレーション
   - 複数シナリオの同時比較
   - What-if分析の強化

3. **詳細な予算分析**
   - 部署別コスト分析
   - 採用ROI計算
   - 予算上限アラート

4. **レポート機能拡張**
   - 採用計画進捗レポート
   - 組織効率分析
   - 意思決定支援ダッシュボード

### **フェーズ3: マルチテナント・スケーラビリティ対応（3-4ヶ月）**
**目標**: SaaS基盤の確立と複数顧客対応

#### 主要機能
1. **Supabaseマルチテナントアーキテクチャ**
   - Row Level Security (RLS)による完全データ分離
   - Supabase Authによるテナント別ユーザー管理
   - リアルタイム機能によるマルチユーザー対応

2. **認証・権限システム拡張**
   - Supabase Auth統合（NextAuth.jsから移行）
   - 細かい権限制御（RLSポリシー）
   - サブドメイン対応とテナント自動識別

3. **パフォーマンス最適化**
   - Edge Functions活用による高速処理
   - Supabaseリアルタイム機能でリアルタイム更新
   - PostgreSQLインデックス最適化

4. **テナント管理システム**
   - Stripe連携による課金状態監視
   - 使用量監視ダッシュボード
   - テナント設定管理

#### Supabase技術設計
```sql
-- マルチテナント対応データベース設計
CREATE TABLE tenants (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  name VARCHAR(255) NOT NULL,
  subdomain VARCHAR(100) UNIQUE NOT NULL,
  subscription_status VARCHAR(50) DEFAULT 'ACTIVE',
  stripe_customer_id VARCHAR(255),
  stripe_subscription_id VARCHAR(255),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- ユーザープロファイル（Supabase Auth統合）
CREATE TABLE user_profiles (
  id UUID REFERENCES auth.users(id) PRIMARY KEY,
  tenant_id UUID REFERENCES tenants(id),
  role VARCHAR(50) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLSポリシー設定
ALTER TABLE tenants ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;

-- テナント分離関数
CREATE OR REPLACE FUNCTION get_user_tenant_id()
RETURNS UUID AS $$
BEGIN
  RETURN (SELECT tenant_id FROM user_profiles WHERE id = auth.uid());
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

#### Edge Functions活用
```typescript
// 予算計算処理（Edge Function）
export const calculateBudgetImpact = async (plans: RecruitmentPlan[]) => {
  const { data } = await supabase.functions.invoke('calculate-budget', {
    body: { plans }
  });
  return data;
};

// リアルタイム組織更新
export const useRealtimeOrgUpdates = (tenantId: string) => {
  useEffect(() => {
    const subscription = supabase
      .channel('org_updates')
      .on('postgres_changes', 
        { event: '*', schema: 'public', table: 'employees', filter: `tenant_id=eq.${tenantId}` },
        handleRealtimeUpdate
      )
      .subscribe();
  }, [tenantId]);
};
```

### **フェーズ4: 課金・エンタープライズ機能（2-3ヶ月）**
**目標**: 収益化と高度機能による差別化

#### 主要機能
1. **Stripe課金・請求システム**
   - 月額5万円固定料金の自動継続課金
   - Stripe Webhookによるリアルタイム支払い状況更新
   - 自動請求書生成・送付
   - Customer Portalによる支払い方法管理

2. **高度な分析機能**
   - 組織健康度スコア（Edge Functions活用）
   - 採用効率分析・ROI計算
   - 業界ベンチマーク比較

3. **API・連携機能**
   - Supabase API自動生成による外部連携
   - Webhook機能（組織変更通知）
   - データインポート/エクスポート（CSV、JSON）

4. **エンタープライズ機能**
   - Supabase AuthによるSSO対応
   - 詳細監査ログ（RLS活用）
   - カスタムレポート作成機能

#### Stripe統合設計
```typescript
// Stripe Subscription管理
interface StripeIntegration {
  // 新規テナント登録時
  async createCustomerAndSubscription(tenant: Tenant): Promise<{
    customerId: string;
    subscriptionId: string;
  }> {
    const customer = await stripe.customers.create({
      name: tenant.name,
      email: tenant.adminEmail,
      metadata: { tenantId: tenant.id }
    });

    const subscription = await stripe.subscriptions.create({
      customer: customer.id,
      items: [{ price: 'price_monthly_50000_jpy' }],
      metadata: { tenantId: tenant.id }
    });

    return { customerId: customer.id, subscriptionId: subscription.id };
  }

  // Webhook処理
  async handleWebhook(event: Stripe.Event): Promise<void> {
    switch (event.type) {
      case 'invoice.payment_succeeded':
        await this.updateTenantSubscriptionStatus(event.data.object);
        break;
      case 'invoice.payment_failed':
        await this.handlePaymentFailure(event.data.object);
        break;
    }
  }
}

// Supabase Edge Function (Stripe Webhook)
export const stripeWebhook = async (req: Request) => {
  const sig = req.headers.get('stripe-signature');
  const body = await req.text();
  
  const event = stripe.webhooks.constructEvent(body, sig!, process.env.STRIPE_WEBHOOK_SECRET!);
  
  // Supabaseに支払い状況を更新
  await supabase
    .from('tenants')
    .update({ subscription_status: getStatusFromEvent(event) })
    .eq('stripe_customer_id', event.data.object.customer);
};
```

## 🏗️ 技術アーキテクチャ拡張

### データベース設計
```typescript
// 新規ドメインモデル
interface RecruitmentPlan {
  id: string;
  tenantId: string;
  positionTitle: string;
  department: string;
  reportingManager: string;
  requiredSkills: string[];
  estimatedSalary: number;
  targetHireDate: Date;
  urgency: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL';
  reason: 'EXPANSION' | 'REPLACEMENT' | 'NEW_INITIATIVE';
  status: 'PLANNED' | 'APPROVED' | 'IN_PROGRESS' | 'HIRED' | 'CANCELLED';
  approvalWorkflow?: ApprovalWorkflow;
  budgetImpact: BudgetImpact;
}

interface ApprovalWorkflow {
  id: string;
  steps: ApprovalStep[];
  currentStep: number;
  status: 'PENDING' | 'APPROVED' | 'REJECTED';
  approvers: User[];
  comments: Comment[];
}

interface BudgetImpact {
  monthlyCost: number;
  annualCost: number;
  departmentBudgetImpact: number;
  totalBudgetImpact: number;
  effectiveDate: Date;
}
```

### サービス層拡張
```typescript
// 新規サービスクラス
export class RecruitmentPlanManager {
  async createPlan(tenantId: string, plan: RecruitmentPlan): Promise<RecruitmentPlan>
  async updatePlan(planId: string, updates: Partial<RecruitmentPlan>): Promise<RecruitmentPlan>
  async getPlansWithTimeline(tenantId: string, timeRange: DateRange): Promise<RecruitmentPlan[]>
  async calculateBudgetImpact(plans: RecruitmentPlan[]): Promise<BudgetImpact>
}

export class ApprovalWorkflowEngine {
  async submitForApproval(planId: string, approvers: User[]): Promise<ApprovalWorkflow>
  async processApproval(workflowId: string, decision: ApprovalDecision): Promise<ApprovalWorkflow>
  async getWorkflowStatus(workflowId: string): Promise<ApprovalWorkflow>
}

export class BudgetCalculator {
  calculateRecruitmentCost(plan: RecruitmentPlan): BudgetImpact
  getDepartmentBudgetSummary(tenantId: string, departmentId: string): BudgetSummary
  forecastBudgetImpact(plans: RecruitmentPlan[], timeframe: number): BudgetForecast
}
```

### UI拡張コンポーネント
```typescript
// 新規UIコンポーネント
export const RecruitmentPlanNode: React.FC<{plan: RecruitmentPlan}>
export const RecruitmentTimeline: React.FC<{plans: RecruitmentPlan[]}>
export const BudgetDashboard: React.FC<{impact: BudgetImpact}>
export const ApprovalFlowViewer: React.FC<{workflow: ApprovalWorkflow}>
```

## 🛡️ マルチテナント設計

### データ分離戦略
- **方式**: Shared Database + tenant_id分離
- **セキュリティ**: Row Level Security (RLS)
- **パフォーマンス**: tenant_id + 主要カラムのコンポジットインデックス

### テナント管理
```typescript
interface Tenant {
  id: string;
  name: string;
  subdomain: string; // example.orgchart-manager.com
  subscriptionStatus: 'ACTIVE' | 'SUSPENDED' | 'CANCELLED';
  maxEmployees: number;
  features: TenantFeature[];
  billingInfo: BillingInfo;
  createdAt: Date;
}

interface TenantContext {
  tenantId: string;
  user: User;
  permissions: Permission[];
}
```

## 📊 開発スケジュール概要

| フェーズ | 期間 | 主要マイルストーン | チーム構成 |
|---------|------|------------------|------------|
| **フェーズ1** | 2-3ヶ月 | 採用計画MVP完成 | フロントエンド1名、バックエンド1名 |
| **フェーズ2** | 2-3ヶ月 | 承認・シミュレーション完成 | フロントエンド1名、バックエンド1名 |
| **フェーズ3** | 3-4ヶ月 | マルチテナント化完成 | フロントエンド1名、バックエンド2名 |
| **フェーズ4** | 2-3ヶ月 | 課金・エンタープライズ完成 | フロントエンド1名、バックエンド1名 |

**合計開発期間**: 9-13ヶ月

## 🎯 次のアクション

### 即座に開始すべき作業
1. **Supabase環境構築**
   - Supabaseプロジェクト作成・設定
   - データベーススキーマ設計・マイグレーション
   - RLSポリシー設定とテナント分離

2. **採用計画管理システムの実装開始**
   - TypeScript型定義（RecruitmentPlan等）
   - Supabase Client設定とReact統合
   - 基本CRUD API実装

3. **React Flow拡張調査・実装**
   - 採用予定ポジション用カスタムノード作成
   - リアルタイム更新機能（Supabase Realtime）
   - 組織図とタイムラインの連動

4. **Stripe統合準備**
   - Stripe アカウント設定
   - 月額5万円固定料金商品作成
   - Webhook エンドポイント設計

5. **UI/UXデザイン**
   - 採用予定ポジションの視覚的区別デザイン
   - タイムライン表示のインターフェース
   - 予算影響ダッシュボード設計

### 中期準備作業
1. **Supabase Edge Functions開発**
   - 予算計算アルゴリズム実装
   - 承認ワークフロー処理
   - バッチ処理・通知機能
2. **Stripe課金フロー設計**
   - Webhook処理フロー
   - 支払い失敗時の処理
   - 請求書生成ロジック
3. **マルチテナント運用設計**
   - テナント管理ダッシュボード
   - 使用量監視・アラート
   - パフォーマンス監視

## 💡 成功要因

1. **明確な差別化**: 採用計画連動という他にない価値提供
2. **ターゲット特化**: 急成長スタートアップの課題に集中
3. **段階的開発**: MVPから始めてユーザーフィードバックを取得
4. **モダンな技術基盤**: Supabase + Stripeによる高速開発・運用
5. **収益モデル**: 明確な価格設定（月額5万円固定）とStripe自動課金

## 🔧 技術的アドバンテージ

### **Supabase活用メリット**
- **開発速度**: PostgreSQL + Auth + API + Realtimeが統合済み
- **スケーラビリティ**: 自動スケーリングとグローバル配信
- **セキュリティ**: RLSによる企業レベルのデータ分離
- **運用コスト**: サーバーレス構成で初期コスト最小化

### **Stripe統合メリット**
- **課金の確実性**: 自動継続課金とリトライ機能
- **グローバル対応**: 多通貨・多国税制対応
- **管理効率**: Customer Portalで顧客セルフサービス
- **透明性**: リアルタイム課金状況監視

---

**このロードマップにより、急成長スタートアップの組織管理課題を解決する差別化されたSaaSプロダクトの構築が可能になります。**